<<
docs=^
AJAX Library Features and Documentation

note: If you are using this on a version of HTML/OS prior to 4.50 please see compatability notes at the end of this document.

 Loading the library... A single line will enable CLEAR.js
 ---------------
      <script src="<<syspublicurl>>/apps/clear/clear.js"></script>

    - Also with HTML/OS be sure to expand the clear.lib file
      <<expand file="/apps/clear/clear.lib" /expand>>


 Applying AJAX
 ---------------

    - To enable simply add the word AJAX to the form, element, or anchor...
      <form action="theoverlay" method="POST" AJAX>
      <input ... AJAX> - Works with TEXT, TEXTAREA, RADIO, CHECKBOX, HIDDEN, PASSWORD, SELECT, IMAGE, SEARCH (even custom/bogus types)
      <a href="theoverlay" name="myvar" value="myval" AJAX>

    - Additionally the AJAX tag can have an event value like...
      <input type="text" name="myname" AJAX="keyup"><br>

    - By default all elements of a form will be submitted when a form element has AJAX applied, to exclude
      a form element from being submitted when other form elements are triggering the AJAX simply use HOLD
      with the form element. For example to keep a textarea from submiting when other elements change do this...
      <textarea name="mystory" HOLD></textarea>

    - EXPERIMENTAL: You can now add AJAX to div's, this is experimental. Add it something like...
      <div href="theoverlay" AJAX>...</div>


 New HTML/OS Tags
 These tags are to be used in the overlay section of your pages
 ---------------

  endOVERLAY() --OR-- ajaxGOTO('otherPageOrOverlay')
   - Either of these tags replace goto and can be used safely even if AJAX isn't present.

  updateVARS('myvarlist')
    - This tag will update any client side variable specified with the current server values

  writeHTML(element,HTMLtext)
  appendHTML(element,HTMLtext)
 prependHTML(element,HTMLtext)
    - These tags will replace/append/prepend the contents of the client side HTML element with HTMLtext
      suppose your page has this markup
      <div id="message"></div>
      then calling...
      writeHTML('message','Success!!')
      will populate the div with Success!!

  runSCRIPT(text)
    - This will run the javascript (text) at the client

  AJAX.clicked()
    - This returns the INPUT element that triggered the submission.
    - This can be used to determine which element changed.



 Monitoring AJAX
 ---------------

    - Once you have AJAX applied to your elements you may desire to give visual feedback while the
      user awaits a response, or you may need to perform some validation before continuing with the submission.

    - To do this simply create a script tag with something like...
      <script>
       function onAJAX(el){
        alert('AJAX will send now');
       }
      </script>

    - Or to do some kind of validation. "return false" aborts the submission.
      <script>
       function onAJAX(el){
        if (el.value==''){
         alert('Aborting...empty field');
         return false; // abort
        } else {
         alert('AJAX will send now');
        }
       }
      </script>

    - These will work for very simple cases but other scenarios may require finer control.
      <script>
       function onAJAX(element){
        // element is the element that the ajax is/was called on
        // element.name  - the name of the element, this corresponds with the aestiva variable of the same name
        // element.value -
        // element.event - The action that triggered the AJAX. By default it is "change".
        writeHTML('ajaxprogress','Loading...');
       }
       function afterAJAX(element){
        writeHTML('ajaxprogress','');
       }
       function expiredAJAX(element){
        document.location='http://clearjs.org';
       }
      </script>

    - The javascript functions onAJAX, afterAJAX, and expiredAJAX will have access to the following properties
       element.value
       element.event

    - writeHTML(element,HTMLtext) is both an Aestiva function and also a Javascript function. If you use it with Javascript remember to add a semicolon at the end/




 Compatability Notes
 -------------------
 If you are using this library with versions of Aestiva HTML/OS prior to 4.50 then it is compatible but will require a few changes in the 
 syntax from that listed above.

 Generally there are two issues that could affect usage prior to version 4.5

 1. Variable expands - there are two considerations with variable expands in prior versions
    a. Variable expands can be disabled
    b. clear.lib uses a variable expand inside of a function to keep the syntax simple but in pre 4.5 versions this causes an
       'out of memory' condition

    Both of these conditions have been accounted for with clear.lib and version sniffing, but will require a slight modification to your code...
    Usually you would end an overlay with endOVERLAY() --OR-- ajaxGOTO('otherPageOrOverlay')

    On pre 4.5 versions use this instead...

    expand file=endOVERLAY() /expand --OR-- expand file=ajaxGOTO('otherPageOrOverlay') /expand

    This funny looking piece of code will overcome both issues listed above with variable expansion



 2. Tags that are not used for assignment

    in several versions prior to 4.5 you can not have a tag all by itself like this...
    runSCRIPT(^+'^'+^alert('Hello World');^+'^'+^)

    to overcome this simply make an assignment like...
    o=runSCRIPT(^+'^'+^alert('Hello World');^+'^'+^)

    This looks funny but should work fine. Notice the lowercase o. It is unlikely that it will be used as a variable in any other code.

^
>>
<html>
 <head>
  <title>Documentation</title>
  <style>
   BODY           {background-color: #a0b0b1; font-size: 8pt; font-family: Verdana; font-weight: normal; color: #000000; margin:0;padding:0;border:0; overflow: none;}
   TEXTAREA       {font-family: Lucida Console,Courier,Times; font-size: 10pt; width: 100%; height: 100%;}
  </style>
 </head>
 <body style="margin:20px; padding:0; border:none;">
  <textarea name="docs" wrap="off"></textarea>
 </body>
</html>