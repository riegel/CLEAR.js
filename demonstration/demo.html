<<
expand file="/apps/clear/clear.lib" /expand

if message="ERROR" then message="" /if
if mycolor="ERROR" then mycolor="RED" /if
myrandom=random(10000,99999)
mypath="/"
if debug="ERROR" then if debug='false' then debug='true' else debug='false' /if /if



function myfiles(p) locals temp,x,y do
 p=replaceall(p,'../','/')
 temp=filelist('/apps'+p)
 y='<table>'+lf
 for name=temp rowname=x do
  if x[4]='DIR' then x[1]='/'+x[1]+'/' /if
  if x[1]<>'/.TEMP/' and x[1]<>'' then y=y+'<tr><td>'+x[1]+'</td></tr>'+lf /if
 /for
 if y='<table>'+lf and isdir('/apps'+p) then y=y+'<tr><td><i>empty</i></td></tr>'+lf /if
 if y='<table>'+lf then y=y+'<tr><td>directory does not exist</td></tr>'+lf /if
 y=y+'</table>'+lf
 return y /return
/function


>>
<!doctype html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>Mock App</title>
  <style>
   body         {webkit-box-sizing:border-box;moz-box-sizing:border-box;box-sizing:border-box;}
   div          {padding: 5px; margin: 10px;}
   #processing  {border: 2px solid green; width: 230px; height: 24px; background:#eee;}
   #message     {border: 2px solid red; width: 230px; height: 300px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #message2    {border: 2px solid red; width: 230px; height: 300px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #colorchoice {background-color: <<mycolor>>; width: 16px; height: 16px;}
   #theform     {border: 2px solid grey; width: 230px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #colors      {border: 2px solid grey; width: 230px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #pizza       {border: 2px solid grey; width: 230px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #select      {border: 2px solid grey; width: 230px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #otherels    {border: 2px solid grey; width: 230px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #errorarea   {border: 2px solid grey; width: 230px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #filearea    {border: 2px solid grey; width: 230px; height: 500px; background:#fff url('/apps/clear/demonstration/images/bg.png') repeat-x;}
   #listing     {border: 1px solid blue; width: 200px; height: 420px; overflow: auto; background:#fff;}
   textarea     {width: 220px; height: 50px;}
   select       {width: 110px; height: 150px;}
  </style>
  <link rel="stylesheet" href="/apps/clear/demonstration/style.css" type="text/css" media="screen" />
  <link rel="shortcut icon" type="image/x-icon" href="/apps/clear/demonstration/images/favicon.ico"/>
  <link rel="icon" type="image/png" href="/apps/clear/demonstration/images/favicon.png"/>
  <script src="<<syspublicurl>>/apps/clear/clear.js?id=002"></script>
  <script>



   CLEAR.debug=<<debug>>;

   function onAJAX(el){
    if (el.name === 'mypath' && CLEAR.f.right(el.value,1) != '/'){
     CLEAR.f.$('processing').innerHTML='Processing';
     setTimeout('CLEAR.f.$("processing").innerHTML="";',100);
     return false;
    }
    clearTimeout(CLEAR.f.processing.timer);
    CLEAR.f.$('processing').innerHTML='Processing';
    return true;
   }




   function afterAJAX(el){
    CLEAR.f.$('processing').innerHTML='';
    CLEAR.f.processing.timer=setTimeout('CLEAR.f.$("message").innerHTML="";',15000);
    return true;
   }
















  </script>
 </head>
 <body>
  <div id="page-container">
   <div id="demowide">
    <a href="http://clearjs.org">Home</a> | 
    <<ci_edit2('/apps/clear/clear_devel.js',800,600,'View Javascript Source','READONLY')>> | 
    <<ci_edit2('/apps/clear/clear.lib',800,600,'View Library Source','READONLY')>> | 
    <<ci_edit2(page,800,600,'View Source','READONLY')>><br>&nbsp;<br>
    <form action="dosomething" method="post" tag="<<page>>" data-AJAX>
     <table><tr><td valign="top">
      Processing Area:
      <div id="processing"></div>
      Message Area:
      <div id="message"><<showonce('message')>></div>
      Color Area:
      <div id="colors">
       <table><tr><td>
        <div id="colorchoice"></div>
       </td><td>
        <input type="radio" name="mycolor" data-AJAX value="red"  > Red | 
        <input type="radio" name="mycolor" data-AJAX value="green"> Green | 
        <input type="radio" name="mycolor" data-AJAX value="blue" > Blue<br>
        <a href="switchcolor" name="mycolor" value="red" data-AJAX>Red</a> |
        <a href="switchcolor" name="mycolor" value="green" data-AJAX>Green</a> |
        <a href="switchcolor" name="mycolor" value="blue" data-AJAX>Blue</a>
       </td></tr></table>
      </div>
      Pizza Picker
      <div id="pizza">
       <input type="checkbox" name="mytopping" data-AJAX value="Cheese" > Cheese<hr>
       <input type="checkbox" name="mytopping" data-AJAX value="Sausage"  > Sausage | 
       <input type="checkbox" name="mytopping" data-AJAX value="Pepperoni"> Pepperoni | 
       <input type="checkbox" name="mytopping" data-AJAX value="Ham" > Ham<br>
       <input type="checkbox" name="mytopping" data-AJAX value="Olives" > Olives | 
       <input type="checkbox" name="mytopping" data-AJAX value="Onions" > Onions | 
       <input type="checkbox" name="mytopping" data-AJAX value="Peppers" > Peppers<hr>
       <a href="switchpizza" name="mypizza" value="plain" data-AJAX>Cheese</a> |
       <a href="switchpizza" name="mypizza" value="meat" data-AJAX>Meat Lovers</a> |
       <a href="switchpizza" name="mypizza" value="veggie" data-AJAX>Veggie</a> | 
       <a href="switchpizza" name="mypizza" value="all" data-AJAX>Monster</a>
      </div>
     </td><td valign="top">
      Form Area:
      <div id="theform">
       Hidden:<input type="hidden" name="myrandom"><<"<i>"+myrandom+"</i>">><br>
       Username:<input type="text" name="myname" data-AJAX><br>
       Password:<input type="password" name="mypass" data-AJAX><br>
       Story (limit to 100 characters):<br><textarea name="mystory" data-AJAX data-HOLD></textarea><br>
       <input type="submit" name="mybutton" value="Submit"> | 
       <input type="submit" name="mybutton" value="Cancel" disabled> | 
      </div>
      Select Area:
      <div id="select">
       <table><tr><td>
        <select name="mycar" multiple="10" data-AJAX>
         <option <<select_option("ford",mycar)>> >Ford</option>
         <option <<select_option("chevy",mycar)>> >Chevy</option>
         <option <<select_option("chrysler",mycar)>> >Chrysler</option>
         <option <<select_option("volvo",mycar)>> >Volvo</option>
         <option <<select_option("saab",mycar)>> >Saab</option>
         <option <<select_option("mercedes",mycar)>> >Mercedes</option>
         <option <<select_option("honda",mycar)>> >Honda</option>
         <option <<select_option("toyota",mycar)>> >Toyota</option>
         <option <<select_option("subaru",mycar)>> >Subaru</option>
        </select>
       </td><td>
        <a href="pickcontinent" name="mycontinent" value="North America" data-AJAX>North America</a><br>
        <a href="pickcontinent" name="mycontinent" value="Europe" data-AJAX>Europe</a><br>
        <a href="pickcontinent" name="mycontinent" value="Asia" data-AJAX>Asia</a><br>
        <a href="pickcontinent" name="mycontinent" value="Africa" data-AJAX>Africa</a><br>
       </td></tr></table>
      </div>
      <div id="otherels">
       <!-- Other Form elements not so commonly used but here for completeness --><hr>
       TYPE="BOGUS"<input type="bogus" name="myvalue" value="test123" data-AJAX><hr>
       TYPE="SEARCH"<input type="search" name="mysearchvalue" value="search123" data-AJAX><hr>
       TYPE="RESET"<input type="reset" name="myresetvalue" value="reset123" data-AJAX><hr>
       TYPE="IMAGE"<br><input type="image" name="mybutton" value="logo" src="/apps/clear/demonstration/images/sample.png" data-AJAX id="imagebutton"><hr>
      </div>
     </td><td valign="top">
      Files Area:
      <div id="filearea">
       type directory, add trailing slash to list:<br>/apps<input type="text" name="mypath" data-AJAX="keyup dblclick"><br>
       <div id="listing"><<myfiles(mypath)>></div>
      </div>
      ERROR Handling:
      <div id="errorarea">
       These links are here to demonstrate what happens when various error conditions arise<hr>
       <a href="badoverlay" data-AJAX>Bad Overlay</a> | 
       <a href="badjavascript" data-AJAX>Bad Javascript</a> | 
       <a href="<<page>>" data-AJAX>Bad AJAX</a><hr>DEBUG:
       <a href="debug" data-AJAX id="debuglink">Currently:<<debug>></a>
      </div>
     </td></tr></table>
    </form>
   </div>
  </div>
 </body>
</html>









<<overlay dosomething
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 if AJAX.clicked()='mypath' then
  if right(mypath,1)='/' then
   o=writeHTML('listing',myfiles(mypath))
   message=message+'listing: '+mypath
  /if
 elif AJAX.clicked()='myname' then
  if myname='' or myname='ERROR' or myname='Admin' then
   message=message+'Name cannot be blank or Admin'
   myname=''
   o=updateVARS('myname')
  else
   message=message+'"'+myname+'" is available.'
  /if
 elif AJAX.clicked()='mystory' then
  if length(mystory)>100 then
   message=message+'Story must be less than 100 characters. It has been truncated.'
   mystory=left(mystory,100)
   o=updateVARS('mystory')
  else
   message=message+'Story OK'
  /if
 elif AJAX.clicked()='mypass' then
  if length(mypass)<8 then
   message=message+'Password must be at least 8 characters'
  else
   message=message+'Password OK'
  /if
 elif AJAX.clicked()='mytopping' then
  # check for cheese /#
  temp='ERROR'
  for name=mytopping rowname=x do
   if x[1]='cheese' then temp='FOUND' /if
  /for
  if temp='ERROR' then
   mytopping=appends(mytopping,"cheese")
   message=message+'Cheese is required, it has been added.'
  /if
  o=updateVARS('mytopping')
  message=message+'<br>'+rows(mytopping)+' topping(s)<br>'+showtable(mytopping)
 elif AJAX.clicked()='mycolor' then
  o=AJAXgoto('switchcolor')
 elif AJAX.clicked()='mycar' then
  message=message+rows(mycar)+' car maker(s)<br>'+showtable(mycar)
 elif AJAX.clicked()='mybutton' and mybutton="submit" then
  if myname="Admin" or myname="" or myname="ERROR" or mypass="" or mypass="ERROR" or length(mypass)<8 then
   message=message+'Username/Password cannot be blank or Admin, Also password must be 8 characters at least.'
  else
   message=message+'"<span style="color:'+mycolor+';">'+myname+' verified</span>", now click Submit.'
   o=AJAXgoto('secretpage.html')
  /if
 elif AJAX.clicked()='mybutton' and mybutton="logo" then
  message=message+'mybutton.x='+mybutton.x+'<br>mybutton.y='+mybutton.y
 /if
 o=writeHTML('message',message) message="ERROR"
 o=endOVERLAY()
>>





<<overlay switchcolor
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 o=writeHTML('message',message+'Color Changed to: '+mycolor) message="ERROR"
 o=runSCRIPT(^CLEAR.f.$('colorchoice').style.backgroundColor='^+mycolor+^';^)
 o=updateVARS('mycolor')
 o=endOVERLAY()
>>





<<overlay switchpizza
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 if mypizza='plain' then
  mytopping="ERROR"
  mytopping=appends(mytopping,"cheese")
 elif mypizza='meat' then
  mytopping="ERROR"
  mytopping=appends(mytopping,"cheese")
  mytopping=appends(mytopping,"sausage")
  mytopping=appends(mytopping,"pepperoni")
  mytopping=appends(mytopping,"ham")
 elif mypizza='veggie' then
  mytopping="ERROR"
  mytopping=appends(mytopping,"cheese")
  mytopping=appends(mytopping,"olives")
  mytopping=appends(mytopping,"onions")
  mytopping=appends(mytopping,"peppers")
 elif mypizza='all' then
  mytopping="ERROR"
  mytopping=appends(mytopping,"cheese")
  mytopping=appends(mytopping,"sausage")
  mytopping=appends(mytopping,"pepperoni")
  mytopping=appends(mytopping,"ham")
  mytopping=appends(mytopping,"olives")
  mytopping=appends(mytopping,"onions")
  mytopping=appends(mytopping,"peppers")
 /if
 o=writeHTML('message',message+'Pizza Changed to: '+mypizza+'<br>'+showtable(mytopping)) message="ERROR"
 o=updateVARS('mytopping')
 o=endOVERLAY()
>>





<<overlay pickcontinent
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 if mycontinent='North America' then
  mycar="ERROR"
  mycar=appends(mycar,"Ford")
  mycar=appends(mycar,"Chevy")
  mycar=appends(mycar,"Chrysler")
 elif mycontinent='Europe' then
  mycar="ERROR"
  mycar=appends(mycar,"Volvo")
  mycar=appends(mycar,"Saab")
  mycar=appends(mycar,"Mercedes")
 elif mycontinent='Asia' then
  mycar="ERROR"
  mycar=appends(mycar,"Honda")
  mycar=appends(mycar,"Toyota")
  mycar=appends(mycar,"Subaru")
 elif mycontinent='Africa' then
  mycar="ERROR"
 /if
 o=writeHTML('message',message+'Cars from: '+mycontinent+'<br>'+showtable(mycar)) message="ERROR"
 o=updateVARS('mycar')
 o=endOVERLAY()
>>




<<overlay badoverlay

 ;ljdfl; 

>>




<<overlay badjavascript
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 o=writeHTML('message',message+'This has bad javascript.') message="ERROR"
 o=runSCRIPT(^(t.* qw 56  // this line should generate an error.^)
 o=endOVERLAY()
>>




<<overlay debug
 if debug='true' then debug='false' else debug='true' /if
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 o=writeHTML('message',message+'Debug is: '+debug) message="ERROR"
 o=writeHTML('debuglink','Toggle Debug (Currently:'+debug+')')
 o=runSCRIPT(^CLEAR.debug=^+debug)
 o=endOVERLAY()
>>




<<overlay showraw
 message='AJAX.clicked='+ajax.clicked()+'<br>'
 if showraw='true' then showraw='false' else showraw='true' /if
 o=writeHTML('message',message+'showraw is: '+showraw) message="ERROR"
 o=endOVERLAY()
>>